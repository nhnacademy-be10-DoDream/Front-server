<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <title>주문서</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div layout:fragment="content" class="order-container" style="max-width: 900px; margin: 0 auto;">
    <div class="order-wrapper">
        <div class="order-summary card shadow-sm p-4 mb-4">
            <h2 class="fw-bold mb-3">주문 내역</h2>
            <table class="table table-bordered text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th>상품명</th>
                    <th>수량</th>
                    <th>금액</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item, iterStat : ${orderItems}">
                    <td th:text="${item.name}"></td>
                    <td th:text="${item.quantity}"></td>
                    <td th:text="|${#numbers.formatInteger(item.totalPrice, 0, 'COMMA')}원|"></td>

                    <!-- hidden inputs -->
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].id|" th:value="${item.id}" />
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].title|" th:value="${item.name}" />
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].quantity|" th:value="${item.quantity}" />
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].price|" th:value="${item.discountedPrice}" />
                </tr>
                </tbody>
            </table>
        </div>

        <div class="shipping-info card shadow-sm p-4">
            <h3 class="fw-bold mb-3">배송지 정보</h3>
            <div class="mb-3">
                <label class="form-label">받는사람 이름</label>
                <input type="text" name="receiverName" class="form-control" required>
            </div>


            <div class="mb-3">
                <label class="form-label">배송지 선택</label>
                <select class="form-select" id="addressSelector" onchange="fillAddress(this)">
                    <option value="">주소를 선택하세요</option>
                    <option th:each="addr : ${addressList}"
                            th:data-zipcode="${addr.zipcode}"
                            th:data-road="${addr.roadAddress}"
                            th:data-detail="${addr.detailAddress}"
                            th:data-extra="${addr.extraAddress}"
                            th:data-jibun="${addr.jibunAddress}"
                            th:text="|${addr.alias} - ${addr.roadAddress}|">
                    </option>
                </select>
            </div>

            <div class="mb-3 row">
                <label class="form-label">우편번호</label>
                <div class="col-md-8">
                    <input type="text" id="zipcode" name="zipcode" class="form-control" placeholder="우편번호" readonly>
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-outline-secondary w-100" onclick="execDaumPostcode()">우편번호 찾기</button>
                </div>
            </div>


            <div class="row g-2 mb-3">
                <div class="col-md-6">
                    <label class="form-label">도로명 주소</label>
                    <input type="text" id="roadAddress" name="roadAddress" class="form-control" placeholder="도로명 주소" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">지번 주소</label>
                    <input type="text" id="jibunAddress" class="form-control" placeholder="지번 주소" readonly>
                </div>
            </div>

            <div class="row g-2 mb-3">
                <div class="col-md-6">
                    <label class="form-label">참고 항목</label>
                    <input type="text" id="extraAddress" class="form-control" placeholder="참고 항목" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">상세 주소</label>
                    <input type="text" id="detailAddress" name="detailAddress" class="form-control" placeholder="상세 주소">
                </div>
            </div>
            <span id="guide" style="color: #999; display: none;"></span>

            <div class="mb-3">
                <label class="form-label">전화번호</label>
                <input type="tel" name="phoneNumber" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">배송 요청 날짜</label>
                <input type="date" name="wantedDateRaw" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label">배송 방법</label>
                <select name="shippingPolicyId" class="form-select" required>
                    <option value="" disabled selected>배송 정책 선택</option>
                    <option th:each="policy : ${shippingPolicies}"
                            th:value="${policy.id}"
                            th:text="|${policy.name} (+${#numbers.formatInteger(policy.fee, 0, 'COMMA')}원)|"
                            th:disabled="${!policy.active}">
                    </option>
                </select>
            </div>

            <div class="text-end mt-4">
                <strong class="me-2">총 결제 금액:</strong>
                <span class="fw-bold fs-5" th:text="|${#numbers.formatInteger(totalAmount, 0, 'COMMA')}원|">0원</span>
            </div>

            <div class="text-center mt-3">
                <button type="submit" class="btn btn-dark w-100 py-2">결제하기</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>