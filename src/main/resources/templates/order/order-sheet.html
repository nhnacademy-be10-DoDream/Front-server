<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title th:text="#{order.title}">주문서</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div layout:fragment="content" class="order-container" style="max-width: 900px; margin: 0 auto;">
    <form th:action="@{/order/payment}" method="post">
    <div class="order-wrapper">
            <table class="table table-bordered text-center align-middle">
                <thead class="table-light">
                <tr>
                    <th th:text="#{order.summary.product}">상품명</th>
                    <th th:text="#{order.summary.quantity}">수량</th>
                    <th th:text="#{order.summary.price}">금액</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item, iterStat : ${orderItems}">
                    <td th:text="${item.title}"></td>
                    <td th:text="${item.quantity}"></td>
                    <td th:text="|${#numbers.formatInteger(item.salePrice, 0, 'COMMA')} #{order.currency.unit}|"></td>
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].id|" th:value="${item.bookId}" />
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].title|" th:value="${item.title}" />
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].quantity|" th:value="${item.quantity}" />
                    <input type="hidden" th:name="|orderItems[${iterStat.index}].price|" th:value="${item.salePrice}" />
                </tr>
                </tbody>
            </table>
    </div>
    <div class="order-summary card shadow-sm p-4 mb-4">
        <h2 class="fw-bold mb-3" th:text="#{order.summary.title}">주문 내역</h2>

        <div class="shipping-info card shadow-sm p-4">
            <h3 class="fw-bold mb-3" th:text="#{order.summary.shippingInfo}">배송지 정보</h3>

            <div class="guest" th:if="${user == null}">
                <div class="mb-3">
                    <label class="form-label" th:text="#{order.guest.name}">비회원 이름</label>
                    <input type="text" name="guestName" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label" th:text="#{order.guest.phone}">비회원 전화번호</label>
                    <input type="tel" name="guestPhone" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label" th:text="#{order.guest.password}">비회원 비밀번호</label>
                    <input type="password" name="guestPassword" class="form-control" required>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label" th:text="#{order.receiver}">받는사람 이름</label>
                <input type="text" name="receiverName" class="form-control" required>
            </div>

            <div class="mb-3" th:if="${user != null}">
                <label class="form-label" th:text="#{order.address.select}">배송지 선택</label>
                <select class="form-select" id="addressSelector" onchange="fillAddress(this)">
                    <option value="" th:text="#{order.address.select}">주소를 선택하세요</option>
                    <option th:each="addr : ${addressList}"
                            th:data-zipcode="${addr.zipcode}"
                            th:data-road="${addr.roadAddress}"
                            th:data-detail="${addr.detailAddress}"
                            th:data-extra="${addr.extraAddress}"
                            th:data-jibun="${addr.jibunAddress}"
                            th:text="|${addr.alias} - ${addr.roadAddress}|">
                    </option>
                </select>
            </div>

            <div class="mb-3 row">
                <label class="form-label" th:text="#{order.address.postcode}">우편번호</label>
                <div class="col-md-8">
                    <input type="text" id="zipcode" name="zipcode" class="form-control" placeholder="우편번호" readonly>
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-outline-secondary w-100" onclick="execDaumPostcode()" th:text="#{address.search.button}">우편번호 찾기</button>
                </div>
            </div>

            <div class="row g-2 mb-3">
                <div class="col-md-6">
                    <label class="form-label" th:text="#{order.address.road}">도로명 주소</label>
                    <input type="text" id="roadAddress" name="roadAddress" class="form-control" placeholder="도로명 주소" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label" th:text="#{order.address.jibun}">지번 주소</label>
                    <input type="text" id="jibunAddress" class="form-control" placeholder="지번 주소" readonly>
                </div>
            </div>

            <div class="row g-2 mb-3">
                <div class="col-md-6">
                    <label class="form-label" th:text="#{order.address.extra}">참고 항목</label>
                    <input type="text" id="extraAddress" class="form-control" placeholder="참고 항목" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label" th:text="#{order.address.detail}">상세 주소</label>
                    <input type="text" id="detailAddress" name="detailAddress" class="form-control" placeholder="상세 주소">
                </div>
            </div>

            <span id="guide" style="color: #999; display: none;"></span>


            <div class="mb-3">
                <label class="form-label" th:text="#{order.date}">배송 요청 날짜</label>
                <input type="date" name="wantedDateRaw" class="form-control" required>
            </div>

            <div class="mb-3">
                <label class="form-label" th:text="#{order.shipping.policy}">배송 방법</label>
                <select name="shippingPolicyId" class="form-select">
                    <option value="" disabled selected th:text="#{order.shipping.policy}">배송 정책 선택</option>
                    <option th:each="policy : ${shippingPolicies}"
                            th:value="${policy.id}"
                            th:text="|${policy.name} (+${#numbers.formatInteger(policy.fee, 0, 'COMMA')} #{order.currency.unit})|"
                            th:disabled="${!policy.active}">
                    </option>
                </select>
            </div>

            <div class="text-end mt-4">
                <strong class="me-2" th:text="#{order.total.price}">총 결제 금액:</strong>
                <span class="fw-bold fs-5" th:text="|${#numbers.formatInteger(totalAmount, 0, 'COMMA')} #{order.currency.unit}|">0원</span>
            </div>

        </div>
        <div class="text-center mt-3">
            <button type="submit" class="btn btn-dark w-100 py-2" th:text="#{order.button.submit}">결제하기</button>
        </div>
    </div>
    </form>
</div>
</body>
</html>
