<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <title>주문 상세</title>
    <link rel="stylesheet" href="/css/mypage.css">
</head>
<body>
<div layout:fragment="content" class="mypage-content-area" style="max-width: 1300px; margin: 0 auto;">
    <div class="mypage-content-header">
        <h2 class="mypage-section-title">주문 상세</h2>
    </div>

    <!-- 주문 상품 -->
    <div class="info-card">
        <div class="info-card-header">
            <h3 class="mypage-subtitle">주문 상품</h3>
        </div>
        <div class="info-card-body">
            <table class="info-table">
                <thead>
                <tr>
                    <th style="width: 30%;">책 제목</th>
                    <th style="width: 15%;">수량</th>
                    <th style="width: 20%;">가격</th>
                    <th style="width: 35%;">포장</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${order.items}">
                    <td th:text="${item.title != null ? item.title : 'N/A'}"></td>
                    <td th:text="${item.quantity}"></td>
                    <td th:text="|${#numbers.formatInteger(item.price, 0, 'COMMA')}원|"></td>
                    <td>
                        <span th:text="${item.wrappingInfo == null || item.wrappingInfo.name == null ? '없음' : item.wrappingInfo.name}"></span>
                        <span th:if="${item.wrappingInfo != null and item.wrappingInfo.price != 0}"
                              th:text="|(+${#numbers.formatInteger(item.wrappingInfo.price, 0, 'COMMA')}원)|"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 주문 정보 -->
    <div class="info-card">
        <div class="info-card-header">
            <h3 class="mypage-subtitle">주문 정보</h3>
        </div>
        <div class="info-card-body">
            <table class="info-table">
                <tr><th>주문번호</th><td th:text="${order.orderId}"></td></tr>
                <tr><th>주문일시</th><td th:text="${#temporals.format(order.orderDate, 'yyyy-MM-dd HH:mm')}"></td></tr>
                <tr><th>주문자명</th><td th:text="${order.guestName != null ? order.guestName : user.name}"></td></tr>
                <tr><th>전화번호</th><td th:text="${order.guestPhone != null ? order.guestPhone : user.phone}"></td></tr>
                <tr><th>우편번호</th><td th:text="${order.address.zipcode}"></td></tr>
                <tr><th>주소</th><td th:text="${order.address.roadAddress}"></td></tr>
                <tr><th>상세 주소</th><td th:text="${order.address.detailAddress}"></td></tr>
            </table>
        </div>
    </div>

    <!-- 결제 정보 -->
    <div class="info-card">
        <div class="info-card-header">
            <h3 class="mypage-subtitle">결제 정보</h3>
        </div>
        <div class="info-card-body">
            <table class="info-table">
                <tr><th>결제 수단</th><td th:text="${order.payment.method}"></td></tr>
                <tr><th>결제 금액</th><td th:text="|${#numbers.formatInteger(order.payment.amount, 0, 'COMMA')}원|"></td></tr>
                <tr><th>결제일시</th><td th:text="${#temporals.format(order.payment.paidAt, 'yyyy-MM-dd HH:mm')}"></td></tr>
            </table>
        </div>
    </div>

    <!-- 주문 상태 -->
    <div class="info-card">
        <div class="info-card-header">
            <h3 class="mypage-subtitle">주문 상태</h3>
        </div>
        <div class="info-card-body">
            <table class="info-table">
                <tr><th>상태</th><td th:text="${order.status}"></td></tr>
                <tr><th>배송 요청 날짜</th><td th:text="${#temporals.format(order.wantedDate, 'yyyy-MM-dd')}"></td></tr>
            </table>
        </div>
    </div>

    <!-- 버튼 -->
    <div class="mypage-form-group text-center mt-4">
        <a class="btn-mypage btn-outline-gray" href="/">홈으로</a>

        <a th:if="${order.status == '대기'}" href="#" class="btn-mypage btn-outline-danger"
           data-bs-toggle="modal"
           data-bs-target="#cancelReasonModal"
           data-type="cancel"
           th:attr="data-order-id=${order.orderId}">
            주문 취소
        </a>

        <a th:if="${order.status == '배송완료' || order.status == '배송중'}" href="#" class="btn-mypage btn-outline-primary"
           data-bs-toggle="modal"
           data-bs-target="#cancelReasonModal"
           data-type="refund"
           th:attr="data-order-id=${order.orderId}">
            반품 요청
        </a>
    </div>
    <div th:replace="~{order/cancel-sheet :: cancel-modal}"></div>
</div>
</body>
</html>