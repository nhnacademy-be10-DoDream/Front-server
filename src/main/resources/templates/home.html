<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">
<head>
    <title>홈</title>
    <meta charset="UTF-8" />

</head>
<body>
<div layout:fragment="content">
    <!-- 여기에 메인 콘텐츠 -->
    <section class="banner position-relative d-flex justify-content-center align-items-center"
             style="height: 300px; background-image: url('/images/banner-image-bg-1.jpg'); background-size: cover; background-position: center;">

        <div id="carouselExampleAutoplaying" class="carousel slide w-50 h-100" data-bs-ride="carousel">
            <div class="carousel-inner h-100 overflow-hidden">
                <div th:each="book, stat : ${books}" th:class="'carousel-item' + ${stat.index == 0 ? ' active' : ''}">
                    <img th:src="@{${book.bookUrl}}"
                         class="d-block mx-auto"
                         style="max-height: 200px; object-fit: contain;"
                         th:alt="${book.title}" />
                </div>
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </section>

    <!-- 베스트셀러/이달의 도서/추천 도서-->
    <div th:each="bookTagInfo : ${bookTagInfos}">
        <section class="best-seller container my-5">
            <h2 class="mb-4 fw-bold" th:text="${bookTagInfo.tag.tagName}"></h2>

            <div th:with="chunks=${chunksMap[bookTagInfo.tagId]}"
                 th:attr="id='carouselExample__' + ${bookTagInfo.tagId}" class="carousel slide">
                <div class="carousel-inner">
                    <!-- bookList를 6개씩 자른 조각(chunk)을 슬라이드로 반복 -->
                    <div th:each="chunk, stat : ${chunks}" th:class="'carousel-item' + ${stat.index == 0 ? ' active' : ''}">
                        <div class="d-flex justify-content-between gap-3">
                            <div th:each="book : ${chunk}" class="book-card flex-fill">
                                <a th:href="@{/books/{id}(id=${book.bookId})}">
                                    <img th:src="@{${book.bookUrl}}" th:alt="${book.title}" class="img-fluid mb-2" />
                                </a>
                                <h3 th:text="${book.title}">책 제목</h3>
                                <p th:text="${book.author}">작가</p>
                                <span th:text="|₩${#numbers.formatInteger(book.salePrice, 0, 'COMMA')}|">₩0</span>

                                <form th:action="@{/cart/add}" method="post" class="mt-2">
                                    <input type="hidden" name="bookId" th:value="${book.bookId}" />
                                    <input type="hidden" name="quantity" value="1" />
                                    <button type="submit" class="btn btn-primary btn-sm">장바구니 담기</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 슬라이드 이동 버튼 -->
                <div class="white_circle_prev"
                     data-bs-slide="prev"
                     th:attr="data-bs-target='#carouselExample__' + ${bookTagInfo.tagId}"></div>

                <div class="white_circle_next"
                     data-bs-slide="next"
                     th:attr="data-bs-target='#carouselExample__' + ${bookTagInfo.tagId}"></div>
            </div>
        </section>
    </div>

</div>
</body>
</html>
