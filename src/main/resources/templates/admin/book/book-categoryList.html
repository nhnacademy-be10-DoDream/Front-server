<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin}">
<head>
  <title layout:fragment="title">вЈёВёю В╣┤ьЁїЖ│авдг Ж┤ђвдг</title>
</head>
<body>
<main layout:fragment="content" class="admin-content-area">

  <div class="admin-main-header">
    <h2 class="admin-section-title mb-0">вЈёВёю В╣┤ьЁїЖ│авдг Ж┤ђвдг</h2>
    <p th:text="'вЈёВёю ID: ' + ${book.bookId}"></p>
  </div>
  <div class="admin-main-body">
    <div class="admin-section-container">
      <div class="admin-section-header">
        <h3>­ЪЊў ьўёВъг ВЌ░Ж▓░вљю В╣┤ьЁїЖ│авдг </h3>
      </div>
      <div class="admin-section-body">
        <ul class="list-group">
          <li th:each="cat1 : ${bookCategories}" class="list-group-item">
            <span th:text="${cat1.categoryName}"></span>

            <span th:if="${cat1.children}">
        <span th:each="cat2 : ${cat1.children}">
          &nbsp;&gt;&nbsp;<span th:text="${cat2.categoryName}"></span>

          <span th:if="${cat2.children}">
            <span th:each="cat3 : ${cat2.children}">
              &nbsp;&gt;&nbsp;<span th:text="${cat3.categoryName}"></span>

              <span th:if="${cat3.children}">
                <span th:each="cat4 : ${cat3.children}">
                  &nbsp;&gt;&nbsp;<span th:text="${cat4.categoryName}"></span>

                  <span th:if="${cat4.children}">
                    <span th:each="cat5 : ${cat4.children}">
                      &nbsp;&gt;&nbsp;<span th:text="${cat5.categoryName}"></span>
                    </span>
                  </span>

                </span>
              </span>

            </span>
          </span>

        </span>
      </span>
          </li>
        </ul>
        <p th:if="${#lists.isEmpty(bookCategories)}" class="text-muted">вЊ▒вАЮвљю В╣┤ьЁїЖ│авдгЖ░ђ ВЌєВіхвІѕвІц.</p>
      </div>
    </div>

    <div class="admin-section-container">
      <div class="admin-section-header">
        <h3>РЮї ВѓГВаю вўљвіћ ВѕўВаЋьЋа В╣┤ьЁїЖ│авдг</h3>
      </div>
      <div class="admin-section-body">
        <ul class="list-group">
          <li th:each="cat : ${flatBookCategory}" class="list-group-item d-flex justify-content-between align-items-center">
            <span th:text="${cat.categoryName}" class="me-3"></span>

            <div class="d-flex gap-2 align-items-center flex-grow-1">
              <form th:action="@{/admin/book/{bookId}/category/edit(bookId=${bookId})}" method="post" class="d-flex gap-2 align-items-center flex-grow-1">
                <input type="hidden" name="categoryId" th:value="${cat.categoryId}" />
                <div class="category-select-wrapper d-flex gap-2 flex-wrap flex-grow-1"></div>
                <input type="hidden" name="newCategoryId" class="newCategoryId" />
                <button type="submit" class="btn btn-sm btn-outline-secondary">ВѕўВаЋ</button>
              </form>

              <form th:action="@{/admin/book/{bookId}/category/remove(bookId=${bookId})}" method="post" class="d-inline ms-2">
                <input type="hidden" name="categoryId" th:value="${cat.categoryId}" />
                <button type="submit" class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('ВЮ┤ В╣┤ьЁїЖ│авдгвЦ╝ ВаюЖ▒░ьЋўВІюЖ▓аВіхвІѕЖ╣ї?');">ВаюЖ▒░</button>
              </form>
            </div>
          </li>
        </ul>
        <p th:if="${#lists.isEmpty(flatBookCategory)}" class="text-muted">ВѓГВаю Ж░ђвіЦьЋю В╣┤ьЁїЖ│авдгЖ░ђ ВЌєВіхвІѕвІц.</p>
      </div>
    </div>

    <div class="admin-section-container">
      <div class="admin-section-header">
        <h3>РъЋ В╣┤ьЁїЖ│авдг ВХћЖ░ђ (Вхювїђ 5вІеЖ│ё)</h3>
      </div>
      <div class="admin-section-body">
        <form th:action="@{/admin/book/{bookId}/category/register(bookId=${bookId})}"
              method="post"
              id="categoryAddForm"
              class="d-flex gap-2 align-items-center flex-nowrap">
          <input type="hidden" id="categoryJsonData" th:value="${categoryJson}" />
          <div id="category-select-wrapper" class="d-flex gap-2"></div>
          <input type="hidden" name="categoryId" id="selectedCategoryId" />
          <button type="submit" class="btn btn-sm btn-outline-primary">+ ВХћЖ░ђ</button>
        </form>
      </div>
    </div>
  </div>
</main>
<th:block layout:fragment="scripts">
  <script type="module" src="/js/category-select.js"></script>
</th:block>
</body>
</html>
