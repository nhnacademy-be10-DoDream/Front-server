<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">

<head>
  <title th:text="#{guestCart.title}">λΉ„νμ› μ¥λ°”κµ¬λ‹</title>
</head>

<body>
<div layout:fragment="content" class="container-fluid my-5">

  <!-- νμ΄μ§€ μ λ© -->
  <h2 class="mb-4 text-center" th:text="#{guestCart.title}">λΉ„νμ› μ¥λ°”κµ¬λ‹</h2>

  <!-- π›’ μ¥λ°”κµ¬λ‹ ν…μ΄λΈ” -->
  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle text-center">
      <thead class="table-light">
      <tr>
        <th th:text="#{cart.header.productName}">μƒν’λ…</th>
        <th th:text="#{cart.header.salePrice}">νλ§¤κ°€</th>
        <th th:text="#{cart.header.quantity}">μλ‰</th>
        <th th:text="#{cart.header.wrapping}">ν¬μ¥μ—¬λ¶€</th>
        <th th:text="#{cart.header.delete}">μ‚­μ </th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item, stat : ${cartItems}">
        <!-- μƒν’λ… + μ΄λ―Έμ§€ -->
        <td style="max-width: 300px;">
          <div class="d-flex align-items-center gap-3">
            <a th:href="@{/books/{id}(id=${item.bookId})}">
              <img th:src="@{|${minioPath.book}${item.bookUrl}|}" alt="μ±… ν‘μ§€" class="img-thumbnail" style="width: 60px;">
            </a>
            <a th:href="@{/books/{id}(id=${item.bookId})}" class="text-decoration-none text-dark">
              <span th:text="${item.title}"></span>
            </a>
          </div>
        </td>

        <!-- νλ§¤κ°€ -->
        <td>
          <span th:text="${#numbers.formatInteger(item.salePrice, 0, 'COMMA')} + 'μ›'"></span>
        </td>

        <!-- μλ‰ λ³€κ²½ -->
        <td>
          <form th:action="@{/guest-cart/update/{id}(id=${item.bookId})}" method="post"
                class="d-flex align-items-center justify-content-center gap-2">
            <input type="hidden" name="_method" value="put"/>
            <input type="number" name="quantity" th:value="${item.quantity}" min="1"
                   class="form-control form-control-sm text-center" style="width: 80px;">
            <button type="submit" class="btn btn-outline-secondary btn-sm" th:text="#{cart.button.change}">λ³€κ²½</button>
          </form>
        </td>

        <!-- ν¬μ¥ μ—¬λ¶€ -->
        <td>
          <select class="form-select form-select-sm wrapping-select" th:attr="data-index=${stat.index}">
            <option data-price="0" value="" th:text="#{cart.wrapping.noSelect}">μ„ νƒ μ• ν•¨</option>
            <option th:each="wrap : ${wrappingOptions}"
                    th:value="${wrap.id}"
                    th:data-price="${wrap.price}"
                    th:text="${wrap.name + ' (' + #numbers.formatInteger(wrap.price, 0, 'COMMA') + 'μ›)'}">
            </option>
          </select>
        </td>

        <!-- μ‚­μ  λ²„νΌ -->
        <td>
          <form th:action="@{/guest-cart/delete/{id}(id=${item.bookId})}" method="post">
            <button type="submit" class="btn btn-danger btn-sm" th:text="#{cart.button.delete}">μ‚­μ </button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- π§Ύ μ£Όλ¬Έ μ”μ•½ λ° μ£Όλ¬Έν•κΈ° λ²„νΌ -->
  <form th:action="@{/order}" method="post" class="mt-5">
    <div class="card shadow-sm p-4">
      <div class="row align-items-center">

        <!-- κ°€κ²© μ”μ•½ μμ—­ -->
        <div class="col-md-8">
          <p class="fs-5 fw-semibold mb-2">
            <span th:text="#{cart.summary.totalProductPrice}">μ΄ μ ν’ κΈμ•΅</span>:
            <span id="totalProductPrice" class="ms-2">0μ›</span>
          </p>
          <p class="fs-5 fw-semibold mb-2">
            <span th:text="#{cart.summary.totalWrappingPrice}">μ΄ ν¬μ¥ κΈμ•΅</span>:
            <span id="totalWrappingPrice" class="ms-2 text-warning">0μ›</span>
          </p>
          <p class="fs-5 fw-semibold">
            <span th:text="#{cart.summary.orderTotal}">μ΄ μ£Όλ¬Έ κΈμ•΅</span>:
            <span id="orderTotal" class="ms-2 fw-bold text-danger">0μ›</span>
          </p>
        </div>

        <!-- μ£Όλ¬Έ λ²„νΌ -->
        <div class="col-md-4 text-md-end text-center mt-3 mt-md-0">
          <button type="submit" class="btn btn-primary btn-lg px-5" th:text="#{cart.button.order}">μ£Όλ¬Έν•κΈ°</button>
        </div>
      </div>

      <!-- hidden DTO ν•„λ“ -->
      <div th:each="item, stat : ${cartItems}">
        <input type="hidden" th:name="|items[${stat.index}].bookId|" th:value="${item.bookId}"/>
        <input type="hidden" th:name="|items[${stat.index}].title|" th:value="${item.title}"/>
        <input type="hidden" th:name="|items[${stat.index}].price|" th:value="${item.salePrice}"/>
        <input type="hidden" th:name="|items[${stat.index}].quantity|" th:value="${item.quantity}"/>
        <input type="hidden" th:name="|items[${stat.index}].wrappingId|"/>
      </div>
    </div>
  </form>


</div>

<!-- μ™Έλ¶€ μ¤ν¬λ¦½νΈ -->
<th:block layout:fragment="scripts">
  <script src="/js/guest-cart.js"></script>
</th:block>
</body>
</html>
