<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mypage}">

<head>
    <title th:text="#{mypage.points.title}"></title>
</head>

<body>
<div layout:fragment="content">

    <div class="mypage-content-header">
        <h2 class="mypage-section-title" th:text="#{mypage.points.heading}"></h2>
        <div class="mypage-counter-text">
            <span th:text="#{pagination.showing(${points.number * points.size + 1}, ${points.number * points.size + points.numberOfElements}, ${points.totalElements})}"></span>
        </div>
    </div>

    <!-- 포인트 이력 없음 -->
    <div th:if="${points.isEmpty()}" class="empty-container">
        <i class="bi bi-coin empty-icon"></i>
        <p class="empty-text" th:text="#{mypage.point.noPointHistory}"></p>
        <a th:href="@{/}" class="btn-mypage btn-dark" th:text="#{mypage.button.startShopping}"></a>
    </div>

    <!-- 포인트 이력 존재 -->
    <div th:if="${!points.isEmpty()}" class="info-card">

        <!-- 카드 본문 - 기존 info-table 사용 -->
        <div class="info-card-body">
            <table class="info-table">
                <thead>
                <tr>
                    <th style="width: 15%;" class="text-center">
                        <i class="bi bi-calendar3 me-1"></i>
                        <span th:text="#{mypage.points.date}"></span>
                    </th>
                    <th style="width: 15%;" class="text-center">
                        <i class="bi bi-tag me-1"></i>
                        <span th:text="#{mypage.points.type}"></span>
                    </th>
                    <th style="width: 40%;">
                        <i class="bi bi-file-text me-1"></i>
                        <span th:text="#{mypage.points.description}"></span>
                    </th>
                    <th style="width: 15%;" class="text-center">
                        <i class="bi bi-coin me-1"></i>
                        <span th:text="#{mypage.points.amount}"></span>
                    </th>
                    <th style="width: 15%;" class="text-center">
                        <i class="bi bi-wallet me-1"></i>
                        <span th:text="#{mypage.points.balance}"></span>
                    </th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="point : ${points.content}">
                    <td class="text-center">
                        <div th:text="${#temporals.format(point.createdAt, 'yyyy-MM-dd')}"></div>
                        <small class="text-muted" th:text="${#temporals.format(point.createdAt, 'HH:mm')}"></small>
                    </td>
                    <td class="text-center">
                                <span class="mypage-badge"
                                      th:classappend="${point.pointType == 'EARN'} ? 'points-earn' : 'points-use'"
                                      th:text="#{${'mypage.points.type.' + point.pointType.toLowerCase()}}">
                                </span>
                    </td>
                    <td>
                        <span th:text="${point.description}"></span>
                    </td>
                    <td class="text-center">
                                <span class="fw-bold"
                                      th:classappend="${point.pointType == 'EARN'} ? 'text-success' : 'text-danger'"
                                      th:text="${(point.pointType == 'EARN' ? '+' : '') + point.amount + 'P'}">
                                </span>
                    </td>
                    <td class="text-center">
                        <span class="text-muted" th:text="${point.balance + 'P'}"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 페이지네이션 -->
    <div th:if="${points.totalPages > 1}" class="pagination-container">
        <ul class="custom-pagination">
            <!-- 처음 페이지 -->
            <li th:classappend="${points.number == 0} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/points(page=1, size=${points.size})}"
                   th:text="#{pagination.first}"></a>
            </li>

            <!-- 이전 페이지 -->
            <li th:classappend="${points.number == 0} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/points(page=${points.number}, size=${points.size})}"
                   th:text="#{pagination.previous}"></a>
            </li>

            <!-- 페이지 번호 -->
            <li th:each="pageNum : ${#numbers.sequence(1, points.totalPages)}"
                th:classappend="${pageNum == points.number + 1} ? 'active'">
                <a class="pagination-link"
                   th:href="@{/mypage/points(page=${pageNum}, size=${points.size})}"
                   th:text="${pageNum}"></a>
            </li>

            <!-- 다음 페이지 -->
            <li th:classappend="${points.number == points.totalPages - 1} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/points(page=${points.number + 2}, size=${points.size})}"
                   th:text="#{pagination.next}"></a>
            </li>

            <!-- 마지막 페이지 -->
            <li th:classappend="${points.number == points.totalPages - 1} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/points(page=${points.totalPages}, size=${points.size})}"
                   th:text="#{pagination.last}"></a>
            </li>
        </ul>
    </div>

    <!-- 포인트 적립 안내 카드 -->
    <div class="info-card">
        <div class="info-card-header">
            <h6 class="mb-0">
                <i class="bi bi-info-circle me-2"></i>
                <span th:text="#{points.info.title}"></span>
            </h6>
        </div>
        <div class="info-card-body">
            <div class="info-card-item">
                <div class="info-card-value">
                    <ul>
                        <li th:text="#{points.info.purchase}"></li>
                        <li th:text="#{points.info.review}"></li>
                        <li th:text="#{points.info.signup}"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>
</body>
</html>
