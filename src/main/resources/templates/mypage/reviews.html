<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/mypage}">

<head>
    <title th:text="#{mypage.reviews.title}"></title>
</head>

<body>
<div layout:fragment="content">

    <div class="mypage-content-header">
        <h2 class="mypage-section-title" th:text="#{mypage.reviews.heading}"></h2>
        <div class="mypage-counter-text">
            <span th:text="#{pagination.showing(${reviews.number * reviews.size + 1}, ${reviews.number * reviews.size + reviews.numberOfElements}, ${reviews.totalElements})}"></span>
        </div>
    </div>

    <!-- 리뷰 목록 -->
    <div th:if="${reviews.isEmpty()}" class="empty-container">
        <i class="bi bi-star empty-icon"></i>
        <p class="empty-text" th:text="#{mypage.review.noReviews}"></p>
        <a th:href="@{/}" class="btn-mypage btn-dark" th:text="#{mypage.button.startShopping}"></a>
    </div>

    <div th:if="${!reviews.isEmpty()}">
        <div th:each="review : ${reviews.content}" class="info-card">

            <div class="info-card-header">
                <div class="mypage-subtitle">
                    <span th:each="i : ${#numbers.sequence(1, 5)}"
                          class="bi"
                          th:classappend="${i <= review.rating} ? 'bi-star-fill' : 'bi-star'"
                          th:style="${i <= review.rating} ? 'color: #ffc107;' : 'color: #6c757d;'"></span>
                    <span th:text="${review.rating} + '.0'"></span>
                </div>
                <div class="info-card-label">
                    <i class="bi bi-person"></i>
                    <span th:text="#{mypage.review.author}"></span>
                    <span th:text="${review.userId}"></span>
                </div>
            </div>

            <!-- 리뷰 본문 -->
            <div class="info-card-body">

                <!-- 리뷰 내용 -->
                <div class="info-card-item">
                    <div class="info-card-label">
                        <i class="bi bi-chat-quote"></i>
                        <span th:text="#{mypage.review.content}"></span>
                        <div class="right-group">
                            <span th:text="#{mypage.review.writeDate}"></span>:
                            <span th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                        </div>
                    </div>
                    <div class="info-card-value">
                        <p th:text="${review.content}"></p>
                    </div>
                </div>

                <!-- 리뷰 이미지 -->
                <div th:if="${!#lists.isEmpty(review.images)}" class="info-card-item">
                    <div class="info-card-label">
                        <i class="bi bi-images"></i>
                        <span th:text="#{mypage.review.image.title}"></span>
                    </div>
                    <div class="info-card-value">
                        <a th:each="image : ${review.images}"
                           th:href="@{${minioPath.review + image}}"
                           target="_blank"
                           rel="noopener noreferrer">
                            <img th:src="${minioPath.review + image}"
                                 th:alt="#{mypage.review.image.alt}"
                                 class="review-thumbnail">
                        </a>
                    </div>
                </div>

            </div>

            <!-- 액션 버튼들 -->
            <div class="info-card-actions">
                <a th:href="@{/books/{bookId}(bookId=${review.bookId})}" class="btn-mypage btn-dark">
                    <i class="bi bi-book btn-icon"></i><span th:text="#{mypage.button.viewBook}"></span>
                </a>

                <button type="button" class="btn-mypage btn-outline-gray review-update-modal"
                        th:data-review-id="${review.reviewId}"
                        th:data-content="${review.content}"
                        th:data-rating="${review.rating}"
                        th:data-images="${#strings.listJoin(review.images, ',')}"
                        th:data-base-path="@{${minioPath.review}}"
                        data-bs-toggle="modal"
                        data-bs-target="#reviewUpdateModal">
                    <i class="bi bi-pencil btn-icon"></i><span th:text="#{button.edit}"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- 페이지네이션 -->
    <div th:if="${reviews.totalPages > 1}" class="pagination-container">
        <ul class="custom-pagination">
            <li th:classappend="${reviews.first} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/reviews(page=0, size=${reviews.size})}"
                   th:text="#{pagination.first}"></a>
            </li>
            <li th:classappend="${reviews.first} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/reviews(page=${reviews.number - 1}, size=${reviews.size})}"
                   th:text="#{pagination.previous}"></a>
            </li>
            <li th:each="pageNum : ${#numbers.sequence(T(java.lang.Math).max(0, reviews.number - 2), T(java.lang.Math).min(reviews.totalPages - 1, reviews.number + 2))}"
                th:classappend="${pageNum == reviews.number} ? 'active'">
                <a class="pagination-link"
                   th:href="@{/mypage/reviews(page=${pageNum}, size=${reviews.size})}"
                   th:text="${pageNum + 1}"></a>
            </li>
            <li th:classappend="${!reviews.last} ? 'disabled'">
                <a class="pagination-link"
                   th:if="${reviews.number < reviews.totalPages - 1}"
                   th:href="@{/mypage/reviews(page=${reviews.number + 1}, size=${reviews.size})}"
                   th:text="#{pagination.next}"></a>
            </li>

            <li th:classappend="${reviews.last} ? 'disabled'">
                <a class="pagination-link"
                   th:href="@{/mypage/reviews(page=${reviews.totalPages - 1}, size=${reviews.size})}"
                   th:text="#{pagination.last}"></a>
            </li>
        </ul>
    </div>

    <div th:replace="~{mypage/fragments/review-update-modal :: #reviewUpdateModal}"></div>
</div>
</body>
</html>
